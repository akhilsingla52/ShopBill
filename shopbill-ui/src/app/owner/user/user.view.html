<div class="addButton" data-bs-toggle="modal" data-bs-target="#addUpdateModel" (click)="openAddModel()">
    <i class="fa fa-plus fa-2x text-white" aria-hidden="true"></i>
</div>

<div class="form">
    <div class="input-group mb-3">
        <span class="input-group-text" (click)="getUserPage()"><i class="fas fa-search"></i></span>
        <input type="text" class="form-control" placeholder="Search user..." [(ngModel)]="params.search"
            (keyup.enter)="getUserPage()">
        <span class="input-group-text" (click)="getUserPage()">Search</span>
    </div>
</div>

<ngb-pagination class="float-end" [(page)]="params.page" [(pageSize)]="params.size"
    [(collectionSize)]="params.totalElements" [maxSize]="5" [ellipses]="false" [boundaryLinks]="true" size="sm"
    (pageChange)="getUserPage()"></ngb-pagination>

<div class="panel-body">
    <table class="table table-striped table-condensed table-hover">
        <thead>
            <tr>
                <th *ngFor="let head of headElements; let i = index" (click)="orderBy(head.sort)">
                    {{ head.element }}
                    <em class='fas' *ngIf="params.sort[0] === head.sort || params.sort[0] === (head.sort+',desc')"
                        [ngClass]="params.sort[0]===head.sort ? 'fa-caret-up' : 'fa-caret-down'"></em>
                </th>
                <th class="text-center">
                    <em class="fa fa-cog"></em>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr *ngIf="users.length === 0">
                <td colspan="8">No User to Display</td>
            </tr>

            <tr *ngFor="let u of users; let i = index">
                <td *ngFor="let head of headElements; let i = index" (click)="orderBy(head.sort)">
                    <span *ngIf="!(head.sort === 'type.messageEn')">{{ u[head.sort] }}</span>
                    <span *ngIf="head.sort === 'type.messageEn'">{{ u.type.messageEn }}</span>
                </td>
                <td class="text-center p-0" *ngIf="u.delYn === 'N'">
                    <a class='me-2 btn text-success edit-button' 
                        data-bs-toggle="modal" data-bs-target="#showModel"
                        (click)="user=u">
                        <em class='far fa-eye'></em>
                    </a>
                    <a class='me-2 btn text-primary edit-button' 
                        data-bs-toggle="modal" data-bs-target="#addUpdateModel"
                        (click)="openUpdateModel(u)">
                        <em class='far fa-edit'></em>
                    </a>
                    <a class='btn text-danger delete-button' (click)="deleteUserById(u, i)">
                        <em class='far fa-trash-alt'></em>
                    </a>
                </td>
                <td class="text-center p-0" *ngIf="u.delYn === 'Y'">
                    <a class='btn text-success edit-button' (click)="activateUser(u)">
                        <em class='fa fa-check'></em>
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Create Update Modal -->
<div class="modal fade" id="addUpdateModel" role="dialog" 
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert-info">
                <h1 class="mx-auto">{{modelHeader}} User</h1>
                <button class="btn-close position-absolute end-0 pe-5" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form [formGroup]="form" (ngSubmit)="createUpdateUser()" novalidate>
                    <input type="hidden" name="id" formControlName="id">

                    <div class="row">
                        <div class="col-md-6 mb-3" formGroupName="type">
                            <label for="name">User Type<i class="far fa-asterisk text-danger"
                                    aria-hidden="true"></i></label>
                            <select name="codeKey" class="form-control" formControlName="codeKey" [ngClass]="{
                                'is-valid': getControls('type.codeKey').valid && (getControls('type.codeKey').dirty || getControls('type.codeKey').touched),
                                'is-invalid': getControls('type.codeKey').invalid && (getControls('type.codeKey').dirty || getControls('type.codeKey').touched)
                            }">
                                <option disabled>Select User Type</option>
                                <option *ngFor="let ut of userTypes" [value]="ut.codeKey">{{ut.messageEn}}</option>
                            </select>

                            <div class="text-danger"
                                *ngIf="getControls('type.codeKey').invalid && (getControls('type.codeKey').dirty || getControls('type.codeKey').touched)">
                                <p>Please select address type</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="code">User Code<i class="far fa-asterisk text-danger"
                                    aria-hidden="true"></i></label>
                            <input class="form-control" type="text" formControlName="code"
                                placeholder="Enter user Name" required [ngClass]="{
                                        'is-valid': f.code.valid && (f.code.dirty || f.code.touched),
                                        'is-invalid': f.code.invalid && (f.code.dirty || f.code.touched)
                                    }">
                            <div class="text-danger" *ngIf="f.code.invalid && (f.code.dirty || f.code.touched)">
                                <p>Please enter user code</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Full Name<i class="far fa-asterisk text-danger"
                                    aria-hidden="true"></i></label>
                            <input class="form-control" type="text" formControlName="name"
                                placeholder="Enter user Name" required [ngClass]="{
                                        'is-valid': f.name.valid && (f.name.dirty || f.name.touched),
                                        'is-invalid': f.name.invalid && (f.name.dirty || f.name.touched)
                                    }">
                            <div class="text-danger" *ngIf="f.name.invalid && (f.name.dirty || f.name.touched)">
                                <p>Please enter full name</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Balance<i class="far fa-asterisk text-danger" aria-hidden="true"></i></label>
                            <input class="form-control" type="number" formControlName="balance" placeholder="Enter balance"
                                required [ngClass]="{
                                    'is-valid': f.balance.valid && (f.balance.dirty || f.balance.touched),
                                    'is-invalid': f.balance.invalid && (f.balance.dirty || f.balance.touched)
                                }">
                            <div class="text-danger" *ngIf="f.balance.invalid && (f.balance.dirty || f.balance.touched)">
                                <p>Please enter balance</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Mobile<i class="far fa-asterisk text-danger" aria-hidden="true"></i></label>
                            <input class="form-control" type="number" formControlName="mobile" placeholder="Enter mobile"
                                required [ngClass]="{
                                    'is-valid': f.mobile.valid && (f.mobile.dirty || f.mobile.touched),
                                    'is-invalid': f.mobile.invalid && (f.mobile.dirty || f.mobile.touched)
                                }">
                            <div class="text-danger" *ngIf="f.mobile.invalid && (f.mobile.dirty || f.mobile.touched)">
                                <p>Please enter mobile</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Phone</label>
                            <input class="form-control" type="number" formControlName="phone" placeholder="Enter phone">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Email</label>
                            <input class="form-control" type="email" formControlName="email" placeholder="Enter email">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">GSTIN</label>
                            <input class="form-control" type="text" formControlName="gstin" placeholder="Enter gstin">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Pan</label>
                            <input class="form-control" type="text" formControlName="pan" placeholder="Enter pan">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Address</label>
                            <input class="form-control" type="textarea" formControlName="address" placeholder="Enter address">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">State</label>
                            <input class="form-control" type="text" formControlName="state" placeholder="Enter state">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">State Code</label>
                            <input class="form-control" type="text" formControlName="stateCode" placeholder="Enter stateCode">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Pincode</label>
                            <input class="form-control" type="number" formControlName="pinCode" placeholder="Enter pincode">
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="name">Remark</label>
                            <input class="form-control" type="text" formControlName="remark" placeholder="Enter remark">
                        </div>

                    </div>

                    <div class="col-md-12">
                        <button type="submit" class="me-2 btn btn-success"
                            [disabled]="!form.valid">{{modelHeader}}</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Show Model -->
<div class="modal fade" id="showModel" role="dialog" 
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header alert-success">
                <h1 class="mx-auto">User</h1>
                <button class="btn-close position-absolute end-0 pe-5" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">User Type</div>
                        <div class="col-md-6">{{user?.type?.messageEn}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">User Code</div>
                        <div class="col-md-6">{{user?.code}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Full Name</div>
                        <div class="col-md-6">{{user?.name}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Balance</div>
                        <div class="col-md-6">{{user?.balance}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Mobile</div>
                        <div class="col-md-6">{{user?.mobile}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Phone</div>
                        <div class="col-md-6">{{user?.phone}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Email</div>
                        <div class="col-md-6">{{user?.email}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Address</div>
                        <div class="col-md-6">{{user?.address}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">State</div>
                        <div class="col-md-6">{{user?.state}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">State Code</div>
                        <div class="col-md-6">{{user?.stateCode}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Pincode</div>
                        <div class="col-md-6">{{user?.pinCode}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Remark</div>
                        <div class="col-md-6">{{user?.remark}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Created By</div>
                        <div class="col-md-6">{{user?.crtId}}</div>
                    </div>
                    <div class="row py-3">
                        <div class="col-md-6 fw-bold">Created Date</div>
                        <div class="col-md-6">{{user?.crtDtm | date:'mediumDate'}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>